# コマンド層設計

## 概要

mdaitの主要コマンド（sync、trans）の実装と実行フローを管理する層です。各コマンドはcoreモジュールの機能を組み合わせて、ユーザーの要求に応じた処理を実行します。

## 主要コマンド

### syncコマンド
関連付けられたMarkdownファイル群内でユニット単位の同期を行います。

**処理概要：**
- ユニット間のハッシュ・`from`追跡・`need`フラグの同期
- 差分の抽出、未翻訳検出、翻訳対象ユニットの挿入
- 何度実行しても破綻しない冪等性の保証

**参照実装：** `./sync/` ディレクトリ

### transコマンド
`need:translate`が付与されたユニットに対してAI翻訳を実行します。

**処理概要：**
- 翻訳対象ユニットの特定とバッチ処理
- AI翻訳の実行と結果の統合
- ハッシュの更新と`need`タグの除去

**参照実装：** `./trans/` ディレクトリ

## 設計原則

- **コマンドの独立性**: 各コマンドは独立して実行可能
- **コア機能の活用**: [../core/design.md](../core/design.md)で定義された機能を組み合わせて実装
- **設定の統合**: [../config/design.md](../config/design.md)の設定管理を利用
- **エラーハンドリング**: 各処理段階でのエラー検出と適切な通知

## 関連モジュールとの連携

- **core層**: Markdownパーサー、ハッシュ管理、ステータス管理を利用
- **config層**: 翻訳ペア設定、プロバイダー設定を参照
- **ui層**: ステータス表示とユーザーインタラクションを連携
- **utils層**: ファイル操作等の汎用機能を利用

## 参考

- [ルート設計書](../../design.md) - 全体アーキテクチャ
- [../core/design.md](../core/design.md) - コア機能詳細
- [../config/design.md](../config/design.md) - 設定管理