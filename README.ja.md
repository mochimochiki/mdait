# mdait — Markdown AI Translator

mdait は、Markdown ドキュメントを **継続的に多言語運用するための** VS Code 拡張機能です。一度きりの翻訳ではなく、文書構造に基づいて変更を追跡し、「再翻訳が必要な部分」だけを、用語と文脈を保ったまま継続的にAI翻訳できます。

---

## ユースケース

* 多言語で管理される内部ドキュメント
* 英語＋ローカル言語を提供する OSS ドキュメント
* リリース後も継続的に更新される技術文書

これらの環境では、次のような課題がよく発生します。

* ドキュメントが更新されても、どの部分を再翻訳すべきかが分かりにくい
* チャット AI 翻訳では、翻訳の揺れや再現性の低さが運用上の問題になることがある
* 従来のセンテンス単位の機械翻訳では、周辺文脈や文書全体の構造が十分に考慮されず、品質を安定させにくい
* 用語集を用意していても、実際の翻訳作業に確実に反映・維持する仕組みがない

mdait は、こうした **『翻訳運用』上の課題を解決するためのツールです。**

---

## 主な機能

mdait は、Markdown ドキュメントを文書構造に基づいて分割し、それぞれの状態を追跡・可視化することで、翻訳対象を明確にしながらAI翻訳・用語抽出を進められるようにします。

### ユニット単位の同期

* 指定した見出しレベルで Markdown をユニット単位に自動分割
* ユニットごとの内容ハッシュ(CRC32)による訳文/原文対応づけと原文変更検出・要翻訳フラグの付与

### 翻訳フロー可視化

* ユニットごとの翻訳状態をサイドバーに一覧表示
* ディレクトリ・ファイル・ユニット単位での翻訳
* 原文との比較ビューによる確認作業の支援

### 一貫性を維持する AI 翻訳

* 用語集・対象ユニットの前後コンテキストを含む **文脈情報を利用した AI 翻訳**
* 翻訳後の **用語集追加候補の提案** と1クリックでの用語集更新

多言語ドキュメントでは、用語や言い回しの一貫性が品質に直結します。
mdait は、翻訳を個々の文やファイルとしてではなく、文書全体の流れと用語体系の中で扱うことを前提としています。

---

## クイックスタート

1. アクティビティバーから🌐(地球儀)アイコンをクリックしてmdaitビューを開く
2. `mdait.jsonを作成`ボタンでmdait.jsonを作成し、`transPairs`に翻訳元・翻訳先の言語とディレクトリを設定
3. mdait ビューから 🔄(Sync) を実行
4. 翻訳先言語の.mdファイルを開き、見出しに付与されているmdaitマーカー上の▶️(翻訳) ボタンでユニットの翻訳を開始
5. `翻訳完了` にマウスオーバーし、結果サマリと用語集追加候補を確認
6. `原文`をクリックすると、原文との比較ビューが開きます

### 設定例

```json
{
  "transPairs": [
    {
      "sourceLang": "ja",
      "sourceDir": "docs/ja",
      "targetLang": "en",
      "targetDir": "docs/en"
    }
  ],
  "ai": {
    "provider": "vscode-lm",
    "model": "gpt-4.1"
  },
  "sync": {
    "level": 3
  }
}

```

---

## mdaitマーカー

mdaitが管理のために必要とする情報(mdaitマーカー)は、🔄(Sync) によりMarkdownファイル内にhtmlコメントとして埋め込まれます。

```
<!-- mdait {content-hash} from:{source-hash} need:{action} -->
```

`content-hash`：ユニットの内容ハッシュ。1文字でも内容が変わると変化します。mdaitはこのハッシュを用いてユニットの対応関係及び変更を検出します。
`source-hash`：対応する原文ユニットの内容ハッシュ。原文との対応付けを行います。原文が変更された場合、訳文ユニットの `source-hash` と原文ユニットの `content-hash` が不一致となり、再翻訳が必要と判断されます。
`need`：必要なアクション。翻訳が必要なときは`need:translate`、翻訳済みのときは項目自体を省略します。

このマーカーが、mdaitが翻訳情報を管理するために使用する唯一のデータです。管理情報として外部ファイルは一切生成されることはありません。git等のバージョン管理にも非依存です。これにより、柔軟な運用が可能になります。

- 翻訳後に自由に訳文の修正が可能です。`from:{source-hash}`は維持されるため、修正後も原文との対応関係が保たれます。
- `need:translate` を手動で追加/削除することで、特定のユニットを再翻訳対象に指定したり、翻訳済みとしてマークしたりできます。
- 原文に手動で`<!-- mdait -->`を追加することも可能です。例えば、見出しレベルを超えた細かい単位で翻訳管理したい場合などに有用です。マーカー付与後に 🔄(Sync) を実行すると、mdaitが自動的にハッシュを計算して管理下に置きます。

---

## AI 利用とデータの扱い

* mdait では LLM を利用し、翻訳や用語検出などの処理を実行します。AIを利用するコマンドのツールチップには`✨[AI]`が表示されます。
* AIを利用しなくとも、ユニット単位の同期や翻訳状態の可視化などの機能で『翻訳運用』上の課題を解決するためのツールとして利用が可能です。
* VS Code Language Model API（vscode-lm）、 Ollama などに対応しています。
* その他のバックグラウンドでの解析や非公開の通信は行いません。

---

## プロンプト追加指示

`.mdait/mdait-instructions.md`にMarkdownファイルを配置することで、AIプロンプトにドメイン固有の背景知識を追加できます。内容はプロンプトに追記されます。

**例:**

```markdown
---
prompts: ["trans.translate"]
---

# 背景知識

このプロジェクトは金融APIのドキュメントです。
- Settlement: 決済（取引の最終確定）
- Clearing: クリアリング（取引の照合・計算）
```

フロントマターの`prompts`フィールドを省略すると全プロンプトに適用されます。詳細は`design/prompt.md`を参照してください。

---

## ライセンス

Apache License 2.0
詳細は [LICENSE](LICENSE) ファイルを参照してください。
