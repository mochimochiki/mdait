# 高度な機能

このセクションでは、mdaitの高度な機能と活用方法について説明します。

## カスタムプロンプト指示

mdaitでは、AIプロンプトにドメイン固有の背景知識やスタイルガイドを追加できます。

### プロンプト指示ファイルの作成

`.mdait/mdait-instructions.md`ファイルを作成し、Markdownで指示を記述します：

```markdown
---
prompts: ["trans.translate"]
---

# 背景知識

このプロジェクトは金融APIのドキュメントです。

## 用語の定義

- Settlement: 決済（取引の最終確定）
- Clearing: クリアリング（取引の照合・計算）
- Netting: ネッティング（債権債務の相殺）

## スタイルガイド

- 「である」調を使用する
- 技術用語は初出時に英語を併記する（例: 決済（Settlement））
```

### フロントマターの設定

フロントマター（YAMLヘッダー）で、指示を適用するプロンプトを指定できます：

```yaml
---
prompts: ["trans.translate"]
---
```

#### 使用可能なプロンプト識別子

| 識別子 | 説明 |
|-------|------|
| trans.translate | ユニット翻訳時 |
| trans.quality-check | 品質チェック時 |
| term.detect | 用語検出時 |
| term.expand | 用語展開時 |
| trans-selection.translate | 選択範囲翻訳時 |

**すべてのプロンプトに適用**: フロントマターを省略すると、すべてのプロンプトに指示が追加されます。

### 指示内容の記述

プロンプト指示には、以下のような内容を含めることができます：

#### 背景知識
プロジェクトやドメインの文脈情報を提供します。

```markdown
# 背景知識

このドキュメントはKubernetesの内部アーキテクチャを説明するものです。
読者は基本的なKubernetesの知識を持つエンジニアを想定しています。
```

#### スタイル指示
翻訳のトーン、文体、書式について指示します。

```markdown
# スタイルガイド

- 丁寧語（です・ます調）を使用する
- 読者を「あなた」と呼ぶ
- 箇条書きは簡潔に、1項目1文を原則とする
```

## 選択範囲のオンデマンド翻訳

エディタで選択したテキストを、mdaitのステータスに影響を与えずに翻訳できます。

1. エディタでテキストを選択
2. 右クリックして「mdait: 選択範囲を翻訳」を選択
3. 翻訳元言語と翻訳先言語を選択
4. 翻訳結果が新しいエディタタブに表示される

## 前回訳文の参照

原文が更新された際、mdaitは前回の原文をユニットレジストリファイルから参照して、変更情報をAIプロンプトに含めます。

- **保存タイミング**: Sync実行時にすべてのユニットのレジストリを保存
- **ストレージ**: `.mdait/unit-registry`ファイルに圧縮（gzip + base64）
- **ガベージコレクション**: Sync時に不要なレジストリを自動削除
- **バージョン管理**: `.mdait/`ディレクトリは`.gitignore`に追加することを推奨

## 細かいユニット境界の指定

通常、ユニット境界は見出しレベルで自動決定されますが、手動でマーカーを追加することでより細かい単位に分割できます。

### 手動マーカーの追加

原文に`<!-- mdait -->`コメントを挿入します：

```markdown
## Section A

最初の段落です。

<!-- mdait -->

2番目の段落を別ユニットとして管理したい場合、
このようにマーカーを挿入します。
```

### Sync実行

マーカー追加後、Syncを実行すると、mdaitが自動的にハッシュを計算します：

```markdown
## Section A

最初の段落です。

<!-- mdait a1b2c3d4 -->

2番目の段落を別ユニットとして管理したい場合、
このようにマーカーを挿入します。
```

## 次のステップ

[次の章](07-ai-providers.md)では、各AIプロバイダーの詳細な設定方法について説明します。
