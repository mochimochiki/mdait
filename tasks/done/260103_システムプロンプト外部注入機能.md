# 作業チケット: システムプロンプト外部注入機能

## 1. 概要と方針

デフォルトプロンプトを`src/prompts/`に一元管理し、ユーザーが`mdait.json`で外部ファイルパスを指定してプロンプトを上書きできる構成とする。プロンプト内では`{{variable}}`形式のプレースホルダーをサポート。

## 2. シーケンス図

```mermaid
sequenceDiagram
    participant Cmd as Command (trans/term)
    participant PP as PromptProvider
    participant Cfg as Configuration
    participant FS as FileSystem
    participant Def as DefaultPrompts

    rect rgb(240, 248, 255)
        Note over Cmd,Def: プロンプト取得フロー
        Cmd->>PP: getPrompt(promptId, variables)
        PP->>Cfg: prompts設定を確認
        alt カスタムパス指定あり
            Cfg-->>PP: ファイルパス
            PP->>FS: ファイル読み込み
            FS-->>PP: カスタムプロンプト
        else デフォルト使用
            PP->>Def: getDefault(promptId)
            Def-->>PP: デフォルトプロンプト
        end
        PP->>PP: {{変数}}を置換
        PP-->>Cmd: 最終プロンプト
    end
```

## 3. 考慮事項

- デフォルトプロンプトは`src/prompts/defaults.ts`にJSDocコメント付きで定義
- 外部ファイルが存在しない場合はエラーログを出力しデフォルトにフォールバック
- 変数置換は単純な文字列置換（`{{key}}`→`value`）
- 設定スキーマ更新：`prompts`セクション追加

## 4. 実装計画と進捗

- [x] `src/prompts/defaults.ts` - デフォルトプロンプト定義（JSDocでIn/Out記載）
- [x] `src/prompts/prompt-provider.ts` - PromptProviderクラス実装
- [x] `src/prompts/index.ts` - エクスポート
- [x] `schemas/mdait-config.schema.json` - promptsセクション追加
- [x] `src/config/configuration.ts` - prompts設定読み込み対応
- [x] `src/commands/trans/translator.ts` - PromptProvider使用に変更
- [x] `src/commands/term/term-detector.ts` - PromptProvider使用に変更
- [x] `src/commands/term/term-expander.ts` - PromptProvider使用に変更
- [x] `design/prompt.md` - 設計ドキュメント更新
