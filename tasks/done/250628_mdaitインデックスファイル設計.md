# 作業チケット: mdaitインデックスファイル生成・参照による高速化設計

## 1. 概要と方針
- mdait管理下の全ファイル（md, csv等）のユニット情報を集約したインデックスファイルを生成し、各種コマンド（trans, sync、StatusTreeProvider等）で参照することで高速化・拡張性向上を図る。
- インデックスにはハッシュ・from・ファイルパス・ユニット位置・type・lang等を記録。
- syncコマンド時にインデックスを再生成。transやStatusTreeProvider等はインデックスを参照してfrom先や未翻訳ユニット、翻訳状況を即座に特定。
- md以外のフォーマット（csv等）も同じ仕組みで管理可能とする。

## 2. 主な処理フロー
```mermaid
flowchart TD
  A[全ファイル走査(sync)] --> B[ユニット情報抽出]
  B --> C[インデックスファイル生成]
  C --> D[trans/sync/StatusTreeProvider等でインデックス参照]
  D --> E[from先・未翻訳・翻訳状況等の特定]
```

## 3. 主要関数・モジュール
- generateIndexFile: インデックス生成（新規）
- loadIndexFile: インデックス読込（新規）
- transCommand/syncCommand/StatusTreeProvider: インデックス参照による高速化
- indexスキーマ定義（type, hash, from, filePath, unitIndex, lang, ...）

## 4. 考慮事項
- インデックスの更新タイミング（sync時/差分更新）
- インデックス破損・古さ対策（都度再生成/バージョン管理）
- ハッシュ重複時の扱い
- 多フォーマット・多言語拡張性
- 既存コマンドとの互換性
- StatusTreeProvider等のUI系での利用時のキャッシュ・再読込制御

## 5. 実装計画と進捗
- [x] indexスキーマ設計
- [x] generateIndexFile実装
- [x] loadIndexFile実装
- [x] trans/sync/StatusTreeProvider等の参照ロジック修正
- [ ] テスト・パフォーマンス検証

## 6. 実装メモ・テスト観点
- インデックスの正確性・再現性
- 大規模リポジトリでのパフォーマンス
- md/csv混在時の動作
- StatusTreeProviderのリフレッシュ高速化効果

### 実装完了メモ
- IndexManagerをクラスではなく関数群として実装（lintエラー回避）
- syncCommand完了後にインデックス自動生成を追加
- transCommandでインデックス参照によるfrom先解決を実装
- StatusCollectorでインデックス優先参照による高速化を実装
- hash主キー型インデックス構造により、同一原稿の多箇所出現にも対応

