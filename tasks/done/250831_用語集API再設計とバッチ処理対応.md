# ä½œæ¥­ãƒã‚±ãƒƒãƒˆ: ç”¨èªé›†APIå†è¨­è¨ˆã¨ãƒãƒƒãƒå‡¦ç†å¯¾å¿œ

## 1. æ¦‚è¦ã¨æ–¹é‡

ç¾åœ¨ã®TermsCsvã‚¯ãƒ©ã‚¹ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜ã®TermsRepositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å†è¨­è¨ˆã—ã€ä¸¦è¡Œå‡¦ç†ã§ã®é‡è¤‡å•é¡Œã‚’è§£æ±ºã™ã‚‹ãƒãƒƒãƒå‡¦ç†æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### ä¸»ãªæ”¹å–„ç‚¹
- CSVç‰¹åŒ– â†’ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜è¨­è¨ˆ
- å˜ä¸€è¨€èªãƒšã‚¢ â†’ å¤šè¨€èªå¯¾å¿œï¼ˆtransPairsæ´»ç”¨ï¼‰
- é€æ¬¡å‡¦ç† â†’ ãƒãƒƒãƒå‡¦ç†ã«ã‚ˆã‚‹ä¸¦è¡Œå‡¦ç†æœ€é©åŒ–
- æ–°è¦ä½œæˆã®æ„å›³æ˜ç¢ºåŒ–

## 2. ä¸»ãªå‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
graph TB
    A[è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä¸¦è¡Œå‡¦ç†] --> B[ç”¨èªæŠ½å‡º]
    B --> C[ãƒ¡ãƒ¢ãƒªã«å€™è£œè“„ç©]
    C --> D[ãƒãƒƒãƒå‡¦ç†]
    D --> E[é‡è¤‡é™¤å»<br/>å…¨è¨€èªå¯¾å¿œ]
    E --> F[ä¸€æ‹¬ä¿å­˜]

    I[æ—¢å­˜èª­ã¿è¾¼ã¿] --> J[ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè§£æ]
    
    J --> D
```

## 3. ä¸»è¦é–¢æ•°ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

### æ–°ã—ã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
```typescript
interface LanguageTermInfo {
  term: string; // ç”¨èª
  variants: string[]; // è¡¨è¨˜æºã‚Œã®ãƒªã‚¹ãƒˆ
}

interface TermEntry {
  context: string; // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±
  languages: Record<string, LanguageTermInfo>; // è¨€èªã‚³ãƒ¼ãƒ‰ -> ç”¨èªæƒ…å ±
  
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå®Ÿè£…ã‚¯ãƒ©ã‚¹ã§æä¾›ï¼‰
  getLanguages(): string[];
  getTerm(lang: string): string | undefined;
  getvariants(lang: string): string[];
  hasLanguage(lang: string): boolean;
}

interface TermsRepository {
  static create(path: string, transPairs: TransPair[]): TermsRepository
  static load(path: string): Promise<TermsRepository>
  merge(candidates: TermEntry[], transPairs: TransPair[]): void
  save(): Promise<void>
}

// CSVå½¢å¼ã¨ã®å¤‰æ›ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
class TermEntryConverter {
  static fromCsvRow(row: Record<string, string>, allLanguages: string[]): TermEntry
  static toCsvRow(entry: TermEntry): Record<string, string>
}
```

### å®Ÿè£…ã‚¯ãƒ©ã‚¹
- `CsvTermsRepository` - CSVå½¢å¼ã®å®Ÿè£…ï¼ˆè¨€èªãƒ™ãƒ¼ã‚¹æ§‹é€ å¯¾å¿œï¼‰
- `TermGenerator` - ç”¨èªæŠ½å‡ºã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å†è¨­è¨ˆï¼ˆæ–°ã—ã„TermEntryå‡ºåŠ›ï¼‰
- `TermEntryConverter` - CSVâ‡”æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®ç›¸äº’å¤‰æ›

## 4. è€ƒæ…®äº‹é …

ä½œæ¥­ã®å®Œäº†æ™‚ç‚¹ã§ã¯æ—§APIãƒ»æ—§ã‚³ãƒ¼ãƒ‰ã¯æ¨ã¦ã‚‹ã€‚ä½œæ¥­ä¸­ã¯ã„ã£ãŸã‚“ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§æ®‹ã™ãªã©ã®å¯¾å¿œã‚’è¡Œã†ã€‚

### é‡è¤‡æ¤œçŸ¥ãƒ­ã‚¸ãƒƒã‚¯
- transPairsã‹ã‚‰å…¨è¨€èªã‚’æŠ½å‡º
- è¤‡æ•°è¨€èªã§ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆã©ã®è¨€èªã§ã‚‚ä¸€è‡´ã—ãŸã‚‰é‡è¤‡ï¼‰
- è¨€èªãƒ™ãƒ¼ã‚¹æ§‹é€ ã«ã‚ˆã‚Šå‹å®‰å…¨ãªé‡è¤‡æ¤œçŸ¥ãŒå¯èƒ½
- å€™è£œåŒå£«ã®é‡è¤‡ + æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®é‡è¤‡

```typescript
function isDuplicate(entry1: TermEntry, entry2: TermEntry, checkLanguages: string[]): boolean {
  return checkLanguages.some(lang => {
    const term1 = entry1.languages[lang]?.term;
    const term2 = entry2.languages[lang]?.term;
    return term1 && term2 && term1.trim() === term2.trim();
  });
}
```

### ãƒ‡ãƒ¼ã‚¿äº’æ›æ€§
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚‚ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã®ãŸã‚äº’æ›æ€§è€ƒæ…®ã¯ä¸è¦

### å‹å®‰å…¨æ€§ã®å‘ä¸Š
- è¨€èªã”ã¨ã®ç”¨èªæƒ…å ±ãŒæ§‹é€ åŒ–ã•ã‚Œã€term ã¨ variants ãŒå¿…ãšå¯¾ã«ãªã‚‹
- è¨€èªå›ºæœ‰æƒ…å ±ã®æ¬ ææ¤œçŸ¥ãŒå®¹æ˜“
- å°†æ¥ã®æ‹¡å¼µï¼ˆç™ºéŸ³ã€å“è©ãªã©ï¼‰ã¸ã®å¯¾å¿œ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æœ€é©åŒ–
- I/Oå›æ•°ã®æœ€å°åŒ–

## 5. å®Ÿè£…è¨ˆç”»ã¨é€²æ—

- [x] LanguageTermInfoã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
- [x] TermEntryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆè¨€èªãƒ™ãƒ¼ã‚¹æ§‹é€ ï¼‰
- [x] TermsRepositoryã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
- [x] TermEntryConverterã‚¯ãƒ©ã‚¹å®Ÿè£…ï¼ˆCSVç›¸äº’å¤‰æ›ï¼‰
- [x] CsvTermsRepositoryå®Ÿè£…ï¼ˆæ—¢å­˜TermsCsvã®ç§»è¡Œï¼‰
- [x] ãƒãƒƒãƒå‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [x] å¤šè¨€èªé‡è¤‡æ¤œçŸ¥å®Ÿè£…ï¼ˆå‹å®‰å…¨ï¼‰
- [x] TermGeneratorå†è¨­è¨ˆï¼ˆæ–°ã—ã„TermEntryå¯¾å¿œï¼‰
- [x] æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®ç§»è¡Œï¼ˆstatus-tree-term-handlerç­‰ï¼‰
- [x] ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆè¨€èªãƒ™ãƒ¼ã‚¹æ§‹é€ ã®æ¤œè¨¼ï¼‰

âœ… **å…¨ã¦ã®å®Ÿè£…é …ç›®ãŒå®Œäº†ã—ã¾ã—ãŸï¼**

## 6. å®Ÿè£…ãƒ¡ãƒ¢ãƒ»ãƒ†ã‚¹ãƒˆè¦³ç‚¹

### å®Ÿè£…å®Œäº†é …ç›®ã®è©³ç´°

#### ğŸ¯ **è¨€èªãƒ™ãƒ¼ã‚¹æ§‹é€ ã®æ¡ç”¨**
- `LanguageTermInfo`: å„è¨€èªã®ç”¨èªæƒ…å ±ï¼ˆterm + variants + æ‹¡å¼µç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
- `TermEntry`: å¤šè¨€èªå¯¾å¿œã®ã‚¨ãƒ³ãƒˆãƒªï¼ˆcontext + languagesï¼‰
- immutableãªè¨­è¨ˆã§å‰¯ä½œç”¨ã‚’é˜²æ­¢

#### ğŸ”„ **CSVäº’æ›æ€§ã®ä¿è¨¼**
- `TermEntryConverter`: ãƒ•ãƒ©ãƒƒãƒˆæ§‹é€ ï¼ˆCSVï¼‰â‡”æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ï¼ˆTermEntryï¼‰ã®ç›¸äº’å¤‰æ›
- BOMå¯¾å¿œã€äºŒé‡å¼•ç”¨ç¬¦ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã€ãƒ˜ãƒƒãƒ€ãƒ¼è‡ªå‹•è§£æ

#### âš¡ **ãƒãƒƒãƒå‡¦ç†ã®æœ€é©åŒ–**
- ä¸¦è¡Œå‡¦ç†ï¼ˆconcurrency=3ï¼‰ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- é‡è¤‡é™¤å»ã¯å‹å®‰å…¨ãª`TermEntry.isDuplicate`ã§å®Ÿè£…
- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºã¨ä¸­æ–­å¯¾å¿œ

#### ğŸ—ï¸ **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ·æ–°**
- `TermsRepository`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆéä¾å­˜
- ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å°†æ¥ã®YAML/JSONå¯¾å¿œæº–å‚™
- çµ±è¨ˆæƒ…å ±å–å¾—æ©Ÿèƒ½

#### ğŸ”§ **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®å®Œå…¨ç½®æ›**
- æ—§`terms-csv.ts`, `term-generator.ts`ã‚’æ–°APIè¨­è¨ˆã§ç½®æ›
- `extension.ts`ã®ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²ã‚’æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å¤‰æ›´

### ãƒ†ã‚¹ãƒˆè¦³ç‚¹ï¼ˆä»Šå¾Œå®Ÿè£…ï¼‰
- å¤šè¨€èªé‡è¤‡æ¤œçŸ¥ã®ç²¾åº¦ãƒ†ã‚¹ãƒˆ
- CSVâ‡”TermEntryå¤‰æ›ã®å®Œå…¨æ€§ãƒ†ã‚¹ãƒˆ
- ãƒãƒƒãƒå‡¦ç†ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å …ç‰¢æ€§ãƒ†ã‚¹ãƒˆ

## 7. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

å®Ÿè£…å®Œäº†å¾Œï¼š
- YAMLå½¢å¼å¯¾å¿œã®æ¤œè¨
- AIã‚µãƒ¼ãƒ“ã‚¹é€£æºã®å¼·åŒ–
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã¨æœ€é©åŒ–
