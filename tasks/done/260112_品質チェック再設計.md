# 作業チケット: 品質チェック再設計

## 1. 概要と方針

翻訳品質チェック機能を正規表現ベースの個別チェックからmarkdown-itによる構造比較に刷新。より正確で包括的な品質ゲートを実現する。

## 2. 実装内容

### 変更前の課題
- 正規表現による個別チェック（数値、リスト、コードブロック）
- 精度が低く（順序考慮なし、ネスト未対応）
- 重要な構造要素（見出し、リンク、画像など）が未チェック

### 変更後の改善
- markdown-itでパースした構造を比較
- 以下の要素を包括的にチェック:
  - 見出し（レベル別に数を比較）
  - リスト項目（ネストも正確に）
  - コードブロック
  - 引用ブロック
  - テーブル
  - リンク
  - 画像
- 各要素の不一致を具体的に報告（例: 「見出しレベル2の数が不一致: 原文3個 vs 訳文2個」）

## 3. 実装計画と進捗

- [x] TranslationCheckerクラスをmarkdown-itベースに書き換え
- [x] 見出し、リスト、コードブロック、引用、テーブル、リンク、画像のチェック実装
- [x] 各チェックで詳細なエラーメッセージを生成
- [x] テストケースを全面更新（14テストケース）
- [x] 設計ドキュメント（command_trans.md）を更新
- [x] wishlistから該当項目を削除

## 4. 設計との整合性

- 既存のTranslationCheckerインターフェースを維持
- `ReviewReason`のカテゴリを拡張（7種類に増加）
- 設計書の品質チェック説明を更新済み
- 全テストが成功

## 5. 影響範囲

- [src/commands/trans/translation-checker.ts](../src/commands/trans/translation-checker.ts): 完全書き換え
- [src/test/commands/trans/translation-checker.test.ts](../src/test/commands/trans/translation-checker.test.ts): テスト全面更新
- [design/command_trans.md](../design/command_trans.md): 品質チェック説明を更新
- [tasks/wishlist.md](../tasks/wishlist.md): 該当項目削除
